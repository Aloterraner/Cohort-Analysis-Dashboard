{% extends 'base.html' %}

{% block content  %}

  {% if message %}
          <script>
              alert({{message}})
          </script>
  {% endif %}
  <style>

    .link {
      stroke: #000;
      stroke-width: 1.5px;
    }
    
    .node {
      cursor: move;
      fill: #ccc;
      stroke: #000;
      stroke-width: 1.5px;
    }
    
    .node.fixed {
      fill: #f00;
    }
    
            #mynetwork1 {
                width: 800px;
                height: 800px;
                background-color: #ffffff;
                border: 1px solid lightgray;
                position: relative;
                float: left;
            }
    
            #mynetwork2 {
                width: 800px;
                height: 800px;
                background-color: #ffffff;
                border: 1px solid lightgray;
                position: relative;
                float: left;
            }
            
            #mynetwork3 {
                width: 800px;
                height: 800px;
                background-color: #ffffff;
                border: 1px solid lightgray;
                position: relative;
                float: left;
            }
    
    .canvas {
        width:800px;
        height:800px;
    }




</style>
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.css" type="text/css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis-network.min.js"> </script>

</head>
<body>
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="create_group-tab" data-toggle="tab" href="#create_group" role="tab" aria-controls="organisation" aria-selected="true">Group Details</a>
  </li>
  <!--
    <li class="nav-item">
      <a class="nav-link" id="group_list_lab" data-toggle="tab" href="#group_list" role="tab" aria-controls="disease" aria-selected="false">Group List</a>
    </li>
  -->
</ul>
<div class="tab-content" id="myTabContent">
  <div class="tab-pane fade show active" id="create_group" role="tabpanel" aria-labelledby="timeframe-tab">
    <div class="container-fluid" id="graph">
      <div class="row">
      <div class="col-6">
        <br>
        <div class="success_alert_message"></div>
        <form  name="create_group" action="" method = "POST">
          {% csrf_token %}
          <div class="form-group row">
            <label for="" class="col-lg-5 control-label">Group Name <span class="text-danger">*</span></label>
            <div class="col-lg-7">
              <input type="text" class="form-control" id="group_name" name="group_name" placeholder="Please enter group name!">
            </div>
          </div>
          <div class="form-group row">
            <input type="hidden" value="" name="store_selected_activities" class="store_selected_activities" id="store_selected_activities">
            <label for="" class="col-lg-5 control-label">Select Activities<span class="text-danger">*</span></label>
            <div class="col-lg-7">
              <select id="list_of_activities" name="list_of_selected_activities" multiple="multiple">
                {% for activities in activites %}
                      <option value="{{activities}}">{{activities}}</option>
                  {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group row">
            <label for="" class="col-lg-5 control-label"></label>
            <div class="col-lg-7">
              <input type = "button" class="btn btn-primary" value = "Create New Group" name = "create_new_group" id ='create_new_group'/>
              <input type = "button" class="btn btn-danger" value = "Cancel" name="cancel" id ='cancel'/>
            </div>
          </div>
        </form>


      </div>
      <div class="col-6 border rounded">
        <br>
        <table id="dtBasicExample" class="table table-striped table-sm" cellspacing="0" width="100%">
          <thead>
            <tr>
              <th scope="col">SL#</th>
              <th scope="col">Group Name</th>
              <th scope="col">Number of Activities</th>
              <th scope="col" >Action</th>
            </tr>
          </thead>
          <tbody>
            {% for key, value in active_group_details.items %}
            <tr>
              <td scope="row">{{key}}</td>
              <td>{{value.group_name}}</td>
              <td style="text-align: center;">{{value.number_of_activities}}</td>
              <td>
                <input type = "button" group_name={{value.group_name}} class="btn btn-danger unset_group" value = "Delete" name="delete" id ='delete'/>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      </div>
    </div>
    </div>
  </div>

  <div class="tab-pane fade" id="doctor" role="tabpanel" aria-labelledby="concurrency-tab">
    <div class="container-fluid" id="graph">
      <div class="row">
      <div class="col-4">
        <br>
        
      </div>
      <div class="col-8">
        <form  name="perspective_view" action="perspective_view" method = "POST">

            <div class="row">
          <div class=" col-sm-6 col-md-7 col-lg-8">
              {% if log_name != ':notset:' %}
              {% else %}
                <p style="color:red;"> You have not set any event log as input. Use "Event Data" tab to set an event log as input!</p>
              {% endif %}

            {% csrf_token %}

          </div>
        </div>
        <br>
        </form>
          <form action="" method="get">
            {% csrf_token %}
            <div id="mynetwork2"></div>
       </form>
      </div>
    </div>
    </div>

  </div>

  
</div>
</body>



{% endblock %}
{% block script %}
<script type="text/javascript">
  $(document).ready(function() {
        $('#list_of_activities').multiselect();
  });


  // Basic example
  $(document).ready(function () {
    $('.dataTables_length').addClass('bs-select');
  });


$(document).ready(function(){
  $(this).find(".multiselect-selected-text").attr('name', 'sample_name');
  $("input[name='create_new_group']").click(function(){
    var selected_activitity_list = $('.multiselect-selected-text').text();
    $('.store_selected_activities').val(selected_activitity_list)
    var selected_activities = $('.store_selected_activities').val()
    var group_name = $('#group_name').val()
    var token = '{{csrf_token}}';
    var home_url = "/groupmanagement/"
    $.ajax({
      headers: { "X-CSRFToken": token },
      url: "/groupmanagement/ajax/savegroupinfo/",
      type: 'POST',
      data: {'selected_activities': selected_activities,'group_name':group_name,'X-CSRFToken':token},
      dataType:'json',
    }).done(function(result) {
      if (result.success) {
          location.reload(true);
      }else{
        alert(result.responseText)
      }
    });
  });
});


$(document).ready(function(){
  $("input[name='cancel']").click(function(){
    location.reload(true);
  });
});



$(document).ready(function(){
  $("input[name='delete']").click(function(){
    var group_name = $(this).attr("group_name");
    var token = '{{csrf_token}}';
    var home_url = "/groupmanagement/"
    $.ajax({
      headers: { "X-CSRFToken": token },
      url: "/groupmanagement/ajax/changegroupstatus/",
      type: 'POST',
      data: {'group_name':group_name,'X-CSRFToken':token},
      dataType:'json',
    }).done(function(result) {
      if (result.success) {
          location.reload(true);
      }else{
        alert(result.responseText)
      }
    });
  });
});



</script>

{% endblock %}